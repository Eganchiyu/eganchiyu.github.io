---
title: "基于ESP32串口的HLK人体传感器模块上位机"
excerpt: "关于被售后气红温于是手搓了一个上位机这件事..."
date: 2025-12-14
categories:
  - 编程
tags:
  - 博客
  - 记录
  - 编程

entries_layout: grid

# header:
#   teaser: /assets/images/2025-12-14-21-02-11.png
---

# 基于ESP32串口的HLK人体传感器模块上位机

## 前言

之前硬件初恋的时候，买了一个感觉很厉害的人体存在传感器模块，而且很便宜，但是发现这东西，想要改阈值的话，还要上位机来调试、于是去问了售后。我说，我现在手上有一块ESP32，能不能用来做上位机来调整？它说，不行呢亲，一定要买上位机的呢。

于是我被气红温了，和deepseek交流了一个下午，用ESP32手搓了一个上位机。这就是这篇文章的前世故事（bushi）。

> 下简称HLK-LD2402-24G-人体传感器模块为 **HLK**

## 一、整体思路

先说结论：**ESP32 完全可以胜任 HLK 的上位机角色**。

### 整体架构

```
HLK 人体存在模块  <--GPIO-->  ESP32  --> USB串口 -->  PC
```

ESP32 作为上位机处理数据的写入和读取：


1. **接收并回传模块数据**：一端接 HLK 模块，一端接电脑。GPIO端口可以双向传输数据，包括状态信息、参数回读结果等

2. **作为串口监视**：USB串口连接电脑控制台，回传信息。电脑仅作为状态读取，用来实时监控数据状态。

---

**因此，目前也有局限。**

* 现有版本的逻辑只能提前设置好参数，烧录后按**流程运行**，没有健壮的错误处理设计，也不能实时控制。

* 最理想的情况是“上位机”，可以实时监控目前状态（包括门限、目前距离等实时数据），并且可以**在电脑端更改门限**。

---

## 二、硬件连接

### 1️⃣ 所需硬件

* ESP32 开发板（我用的是常见的 ESP32-CH340C）
* HLK 人体存在传感器模块
* 若干杜邦线（硬在哪）

### 2️⃣ 接线说明

以 **UART 通信** 为例：

| HLK 模块 | ESP32            |
| ------ | ---------------- |
| TX     | GPIO16 (RX2)     |
| RX     | GPIO17 (TX2)     |
| GND    | GND              |
| VCC    | 5V / 3.3V（视模块型号） |

都使用学长馈赠的电源模块进行供电。

---

注意，这里有一点踩坑提醒：TX和RX不是对应关系，是数据流的关系，所以RX端口要连接HLK的TX口，TX端口要连接HLK的RX口。

#### TX 和 RX 的含义

* TX（Transmit）：发送端

    👉 表示 “这个引脚负责把数据发出去”

* RX（Receive）：接收端

    👉 表示 “这个引脚负责接收外部发来的数据”

---

## 三、HLK 模块的串口通信特点

在正式写代码前，必须搞清楚 HLK 模块的通信方式。

### 1️⃣ 通信参数

一般为：

* 波特率：115200
* 数据位：8
* 停止位：1
* 校验位：无

### 2️⃣ 数据格式

HLK 模块使用的是：

* **固定帧头**
* **命令字 + 数据区**
* **校验位（通常是累加和）**

例如（示意）：

```
AA 55 0B 01 02 03 XX
```

虽然官方文档写得比较抽象，但通过：

* 文档 + 抓串口数据
* 对比发送前后参数变化

基本可以反推出每条指令的作用。

---

## 四、ESP32 程序设计

### 1️⃣ 串口初始化

```cpp
void setup() {
  Serial.begin(115200);      // PC 串口
  Serial2.begin(115200);     // HLK 模块
}
```

### 2️⃣ 串口桥接逻辑

核心思路非常简单：

* PC → ESP32 → HLK
* HLK → ESP32 → PC

```cpp
void loop() {
  // PC 发给 HLK
  while (Serial.available()) {
    Serial2.write(Serial.read());
  }

  // HLK 返回给 PC
  while (Serial2.available()) {
    Serial.write(Serial2.read());
  }
}
```

到这里，其实**已经可以当“透明上位机”使用了**，直接在电脑串口助手里发十六进制指令即可。

---

## 五、参数配置与调试

有了串口桥接，剩下的事情就简单多了。

### 1️⃣ 使用串口助手

我使用的是：

* SSCOM / XCOM / Arduino 串口监视器

功能需求：

* 支持十六进制发送
* 能清晰看到回传数据

### 2️⃣ 常见可调参数

根据模块不同，通常包括：

* 人体存在判定阈值
* 运动/静止灵敏度
* 最大检测距离
* 状态上报周期

修改流程一般是：

1. 发送「写参数」指令
2. 等待模块返回 ACK
3. 发送「读参数」确认是否生效

---

## 六、效果与总结

最终效果：

* ✅ **无需官方上位机**
* ✅ ESP32 即插即用
* ✅ 参数实时可调
* ✅ 后续可拓展（OLED / Web 配置界面）

从结果来看，这个 HLK 模块并没有任何“不可替代”的上位机逻辑，本质就是串口协议封装。

所谓“必须买官方上位机”，更多是商业策略，而不是技术限制。

---

## 七、后续改进方向

后面我可能会继续折腾：

* ESP32 + WebServer，直接浏览器改参数
* 加 OLED 实时显示人体状态
* 做一个简单 GUI 上位机（Python / Qt）

如果你也被“必须买官方工具”这件事恶心过，希望这篇文章能给你一点参考。

> **能用串口解决的问题，就别急着掏钱。**

---

（完）
